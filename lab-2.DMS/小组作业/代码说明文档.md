# 代码使用说明文档

## 简介

该程序用于根据给定的符号概率分布生成指定长度的符号序列，并将结果保存到指定的文件中。程序可以通过命令行进行参数传递，支持两种运行模式：单元测试模式和正常工作流程模式。

---

## 依赖项

在运行此程序之前，确保已经安装以下依赖库：

- **Python 3.x**
- **numpy**
- **argparse**
- **csv**

你可以使用以下命令安装所需的Python库：

```bash
pip install numpy argparse
```

---

## 使用方法

### 1. 运行单元测试

使用 `-t` 选项可以运行程序自带的单元测试。测试内容包括对不同符号概率分布、消息长度和随机种子情况下程序正确性的验证。

**命令格式：**

```bash
python byteSource.py -t
```

单元测试会执行以下内容：
- 测试均匀分布（每个符号的概率均相等）。
- 测试单个符号的分布（一个符号的概率为1，其他符号为0）。
- 测试不同消息长度。
- 测试不同随机种子对输出的影响。

### 2. 正常运行模式

在正常运行模式下，程序会从指定的输入文件中读取符号概率分布，生成符合该分布的符号序列，并将其保存到输出文件中。

**命令格式：**

```bash
python byteSource.py <input_file> <output_file> <msg_len>
```

- `<input_file>`：包含符号概率分布的CSV文件路径。每行应表示一个符号及其对应的概率值，格式为`符号, 概率`。
- `<output_file>`：保存生成符号序列的文件路径。输出文件中的符号将以逗号分隔。
- `<msg_len>`：生成的符号序列的长度，即消息中符号的数量。

### 参数说明

- **input_file**: 这是一个CSV格式的文件，文件中包含256个符号及其概率分布。每行包含一个符号（0-255）及其对应的概率，格式为：`<symbol>,<probability>`。
- **output_file**: 这是保存生成符号序列的目标文件。生成的符号序列会以逗号分隔并写入该文件中。
- **msg_len**: 生成符号序列的长度，即所需符号的数量。

### 示例

假设你有一个包含符号概率分布的文件 `symbol_prob.csv`，希望生成一个长度为10000的符号序列，并将其保存到 `output.csv` 中。可以使用如下命令：

```bash
python byteSource.py symbol_prob.csv output.csv 10000
```

---

## 程序功能描述

### 1. `parse_sys_args()`

该函数用于解析命令行参数，并返回解析后的结果。支持以下两类参数：
- `-t`: 表示运行单元测试。
- `<input_file>` `<output_file>` `<msg_len>`：正常工作流程所需的参数。

### 2. `read_input(input_path)`

该函数从指定路径的CSV文件中读取符号的概率分布。文件内容应包含256个符号及其对应的概率值。每个符号的概率之和必须为1，否则程序会抛出错误。

**参数：**
- `input_path (str)`：CSV文件的路径。

**返回：**
- `numpy.ndarray`：大小为256的数组，表示每个符号的概率分布。

**示例：**

```csv
0,0.004
1,0.002
2,0.008
...
255,0.001
```

### 3. `write_output(output_path, msg)`

该函数将生成的符号序列写入到指定的输出文件中，符号之间以逗号分隔。

**参数：**
- `output_path (str)`：保存生成符号序列的文件路径。
- `msg (numpy.ndarray)`：生成的符号序列。

### 4. `byte_source(symbol_prob, msg_len)`

根据给定的符号概率分布生成符合该分布的指定长度的符号序列。它通过计算累积概率分布来实现符号的随机采样。

**参数：**
- `symbol_prob (numpy.ndarray)`：符号的概率分布。
- `msg_len (int)`：要生成的符号数量。

**返回：**
- `numpy.ndarray`：生成的符号序列。

### 5. `workflow(input_path, output_path, msg_len)`

该函数负责整个流程：从输入文件中读取符号概率分布，生成符号序列，并将其保存到输出文件中。

**参数：**
- `input_path (str)`：输入CSV文件的路径。
- `output_path (str)`：保存生成符号序列的文件路径。
- `msg_len (int)`：要生成的符号数量。

### 6. `quick_test(symbol_prob, msg_len=100000, num_tests=10)`

该函数用于快速测试生成的符号序列是否符合给定的概率分布。它通过生成多次符号序列并比较生成的概率分布与给定的分布的相对误差来验证正确性。

**参数：**
- `symbol_prob (numpy.ndarray)`：符号概率分布。
- `msg_len (int)`：生成的符号序列长度，默认100000。
- `num_tests (int)`：测试次数，默认10。

**返回：**
- `bool`：测试是否通过。

### 7. `test_flow()`

执行多项单元测试，测试不同条件下程序的正确性，包括不同的符号分布、消息长度和随机种子。

---

## 代码结构图

```plaintext
byteSource.py
│
├── parse_sys_args()         - 解析命令行参数
├── read_input()             - 读取符号概率分布文件
├── write_output()           - 将生成的符号序列写入输出文件
├── byte_source()            - 根据符号概率分布生成符号序列
├── workflow()               - 完整的处理流程：读取输入 -> 生成序列 -> 写入输出
├── quick_test()             - 快速测试生成的符号序列是否符合概率分布
├── test_flow()              - 运行一系列单元测试
└── main()                   - 程序入口，处理命令行输入
```

---

## 注意事项

1. 输入的概率分布文件必须包含256个符号及其概率值，并且所有概率值的和必须为1。
2. 在执行单元测试时，程序会生成临时文件，这些临时文件会在测试结束后自动删除。
3. 如果你在运行过程中遇到问题，请检查文件路径和格式是否正确，确保输入文件中的符号和概率格式符合要求。

---

## 错误处理

- **输入文件错误**：当输入文件的概率分布不符合规范（概率和不等于1）时，程序会抛出`ValueError`。
- **文件路径错误**：如果指定的输入或输出文件路径无效，程序会输出相应的错误提示。

